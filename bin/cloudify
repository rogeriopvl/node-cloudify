#!/usr/bin/env node

var config = require('../lib/config.js')();

if (!config.data.oauth.token) {
    require('../lib/setup.js')();
}
else {
    startup(process.argv);
}

function startup(args) {

    // remove node and cloudify path
    args = args.slice(2);

    if (args.length < 1 || args.length > 2){
        showHelp();
        process.exit(-1);
    }

    var cmd = args.shift();

    if (cmd === '--help' || cmd === '-h') {
        showHelp();
    }
    else if (cmd === '--version' || cmd === '-v') {
        showVersion();
    }
    else {
        var fs = require('fs'),
            options = { download: false };

        if (cmd === '-d') {
            if (args.length < 1)Â {
                showHelp();
                process.exit(-1);
            }
            options.download = true;
            cmd = args.shift();
        }

        if (fs.existsSync(cmd) && !fs.lstatSync(cmd).isDirectory()){
            var cloudify = require('../lib/cloudify.js')(config.data, cmd, options);
            cloudify();
        }
        else {
            console.log('File does not exists or is a directory');
        }
    }
}

function showHelp() {
    console.log('Usage: cloudify [options] <file_to_share>');
    console.log('');
    console.log('Options:');
    console.log('\t-d  (optional) get direct link to file, instead of preview link');
};

function showVersion() {
    var meta = require('../package.json');
    console.log('cloudify version v' + meta.version);
};
