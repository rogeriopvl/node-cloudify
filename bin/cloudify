#!/usr/bin/env node

var config = require('../lib/config.js')();

if (!config.data.oauth.token) {
    require('../lib/setup.js')();
}
else {
    startup(process.argv);
}

function startup(args) {

    // remove node and cloudify path
    args = args.slice(2);

    if (args.length !== 1){
        showHelp();
        process.exit(-1);
    }

    var cmd = args.shift();

    if (cmd === '--help' || cmd === '-h') {
        showHelp();
    }
    else if (cmd === '--version' || cmd === '-v') {
        showVersion();
    }
    else {
        var fs = require('fs');

        if (fs.existsSync(cmd) && !fs.lstatSync(cmd).isDirectory()){
            var cloudify = require('../lib/cloudify.js')(config.data, cmd);
            cloudify();
        }
        else {
            console.log('File does not exists or is a directory');
        }
    }
}

function showHelp() {
    console.log('Usage: cloudify <file_to_share>');
};

function showVersion() {
    var meta = require('../package.json');
    console.log('cloudify version v' + meta.version);
};
